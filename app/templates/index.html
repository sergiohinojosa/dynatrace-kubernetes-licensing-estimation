{% extends "base.html" %}

{% block title %} K8stimator - Kubernetes DPS Costs Estimator {% endblock %}

{% block body %}
<div>
    <h3>K8stimator - Kubernetes DPS Costs Estimator </h3>
</div>

{% if estimate.errors > '' %}

<div class="error">
    <p><strong style="color: black;">⚠️ There was an error: </strong>{{ estimate.errors }}</p>
</div>
{% endif %}

{% if estimate.estimation_running %}

Estimation is being generated for Tenant {{ estimate.tenant_url }}...

please be patient

{% else %}

{% if INSIDE_VPN %}
TODO verify request and modify form. Read ENV variable. maybe use html hidden?
{% endif %}

<form class="pure-form" action="/" method="POST">
    <div class="estimate-form">
        <div class="control-group">
            <div>
                <label>
                    <input type="radio" name="saasRadio" value="SaaS" checked="True">
                    SaaS
                </label>
                <label>
                    <input type="radio" name="saasRadio" value="Managed">
                    Managed
                </label>
            </div>
            <div class="SaaS selectt">
                <label for="tenant_url">Tenant URL</label>
                <input type="text" name="tenant_url" placeholder="https://tenantid.live.dynatrace.com" size="100%"
                    value="{{ estimate.tenant_url }}">
                <br>
            </div>
            <div class="Managed selectt" style="display: none;">
                <label for="tenant_url">Managed MC Url</label>
                <input type="text" name="tenant_url"
                    placeholder="https://{cluster-id}-{nodeNr}.managed.internal.dynatrace.com:8021/e/{managed-tenant-id}"
                    size="100%" value="{{ estimate.tenant_url }}">
                <br>
                <label for="ssoCSRFCookie">ssoCSRFCookie</label>
                <input type="text" name="ssoCSRFCookie" placeholder="ssoCSRFCookie"
                    value="{{ estimate.ssoCSRFCookie }}">
                <br>
                <label for="jsessionId">jsessionId</label>
                <input type="text" name="jsessionId" placeholder="jsessionId" value="{{ estimate.jsessionId }}">
                <br>
            </div>
            <label for="api_token">API Token</label>
            <input type="password" name="api_token" placeholder="dt0c01.xxxxx..." size="100%"
                value="{{ estimate.api_token }}">
            <br>
            <label for="resolution">Resolution</label>
            <input type="text" name="resolution" placeholder="1h" value="{{ estimate.resolution }}">
            <br>
            <label for="from_timeframe">From Timeframe</label>
            <input type="text" name="from_timeframe" placeholder="YYYY-MM-DD" value="{{ estimate.from_timeframe }}">
            <br>
            <label for="iterations">Iterations</label>
            <input type="text" name="iterations" placeholder="4" value="{{ estimate.iterations }}">
            <br>
            <label for="days_per_iteration">Days per iteration</label>
            <input type="text" name="days_per_iteration" placeholder="7" value="{{ estimate.days_per_iteration }}">
            <br>
        </div>
        <input type="submit" value="Estimate costs" class="btn btn-primary btn-lg btn-block">
    </div>

</form>
{% endif %}


<br>
{% if estimate.t_pod_h > 0 %} 
<div class="console">
    
    Estimating costs for Tenant: {{ estimate.tenant_url}} <br>
    --------------------------------------- <br>
    Total Pod Hours: {{ estimate.t_pod_h}} <br>
    Total Gib Hours: {{ estimate.t_gib_h}} <br>
    Total shortliving instances: {{ estimate.t_shortliving_instances}} <br>
    Total instances: {{ estimate.t_instances}}<br>
    ---------------------------------------
    {{ estimate.console | safe }}
    
</div>
{% endif %}

<script type="text/javascript">
    $(document).ready(function () {
        $("input[name$='saasRadio']").
            click(
                function () {
                    const inputValue =
                        $(this).attr("value");
                    const targetBox =
                        $("." + inputValue);
                    $(".selectt").
                        not(targetBox).hide();
                    $(targetBox).show();
                }
            );
    }); 
</script>

{% endblock %}